// Generated by CoffeeScript 1.6.2
(function($) {
  var app;

  window.mycms = {};
  mycms.NoticiaModel = Backbone.Model.extend({
    urlRoot: '/api/noticia',
    initialize: function() {
      return console.log("init model noticia");
    },
    parse: function(response, options) {
      if (response.status === 200) {
        return response.noticia;
      }
      return response;
    }
  });
  mycms.NoticiasCollection = Backbone.Collection.extend({
    model: mycms.NoticiaModel,
    url: "/api/noticias",
    initialize: function() {
      return console.log("init collection noticias");
    },
    parse: function(response, options) {
      if (response.status === 200) {
        return response.noticias;
      }
      return response;
    }
  });
  mycms.NoticiasNewView = Backbone.View.extend({
    el: $('#mainView'),
    initialize: function(options) {
      _.bindAll(this, 'render');
      console.log("Init NoticiasNewView");
      return this.render();
    },
    render: function() {
      var template;

      template = _.template($("#noticiasNewTemplate").html());
      return $(this.el).html(template);
    }
  });
  mycms.PerfilView = Backbone.View.extend({
    el: $('#mainView'),
    initialize: function(options) {
      _.bindAll(this, 'render');
      console.log("Init perfilView");
      return this.render();
    },
    render: function() {
      var template;

      template = _.template($("#perfilTemplate").html());
      return $(this.el).html(template);
    }
  });
  mycms.NoticiasView = Backbone.View.extend({
    el: $('#mainView'),
    initialize: function(options) {
      _.bindAll(this, 'render');
      console.log("Init NoticiasView");
      return this.render();
    },
    render: function() {
      var template;

      template = _.template($('#noticiasTemplate').html(), {
        noticias: this.collection.toJSON()
      });
      return this.$el.html(template);
    }
  });
  mycms.IndexView = Backbone.View.extend({
    el: $('#mainView'),
    initialize: function(options) {
      _.bindAll(this, 'render');
      console.log("Init IndexView");
      return this.render();
    },
    render: function() {
      var template;

      template = _.template($("#indexTemplate").html());
      return $(this.el).html(template);
    }
  });
  mycms.SubheaderView = Backbone.View.extend({
    el: $('#subheader'),
    events: {
      "click .js-dashboard": "home",
      "click .js-perfil": "perfil",
      "click .js-noticias": "noticias",
      "click .js-noticias_new": "noticias_new"
    },
    initialize: function(options) {
      _.bindAll(this, 'render');
      console.log("Init LinksHeaderView");
      return this.render();
    },
    home: function() {
      console.log("home");
      return app.navigate("/panel", true);
    },
    perfil: function() {
      console.log("perfil");
      return app.navigate("/panel/perfil", true);
    },
    noticias: function() {
      console.log("noticias");
      return app.navigate("/panel/noticias", true);
    },
    noticias_new: function() {
      console.log("noticias_new");
      return app.navigate("/panel/noticias/new", true);
    },
    render: function() {
      var template;

      template = _.template($("#subHeaderTemplate").html());
      return $(this.el).append(template);
    }
  });
  mycms.AppRouter = Backbone.Router.extend({
    routes: {
      "panel": "index",
      "panel/perfil": "perfil",
      "panel/noticias": "noticias",
      "panel/noticias/new": "noticias_new"
    },
    initialize: function() {
      console.log("init router");
      return this.SubheaderView = new mycms.SubheaderView();
    },
    index: function() {
      console.log("router index");
      return this.IndexView = new mycms.IndexView();
    },
    perfil: function() {
      console.log("router perfil");
      return this.PerfilView = new mycms.PerfilView();
    },
    noticias: function() {
      var col,
        _this = this;

      console.log("router noticias");
      col = new mycms.NoticiasCollection();
      /*
      params = {
          title: "pepe"
          descripcion: "lalala"
      }
      # Esto lanza un AJAX POST a /noticias
      modelo.save(params)
      # Esto lanza un AJAX PUT a /noticias (Ya existe ese modelo en el server)
      modelo.save(params)
      
      
      #$.ajax('/api/noticias', ......)
      */

      return col.fetch({
        wait: true,
        success: function(collection, response, options) {
          console.log("fetched noticias");
          console.log(collection);
          console.log(response);
          return _this.NoticiasView = new mycms.NoticiasView({
            collection: collection
          });
        }
      });
    },
    noticias_new: function() {
      console.log("router noticias New");
      return this.NoticiasNewView = new mycms.NoticiasNewView();
    }
  });
  app = new mycms.AppRouter();
  return Backbone.history.start({
    pushState: true
  });
})(jQuery);
